---
layout: post
status: publish
published: true
title: 自定义PHP错误
author:
  display_name: admin
  login: admin
  email: combbs@gmail.com
  url: http://seaprince.cn/
author_login: admin
author_email: combbs@gmail.com
author_url: http://seaprince.cn/
excerpt: <p>把PHP的错误显示控制住，并按自己的方式显示。</p>
wordpress_id: 170
date: !binary |-
  MjAwOC0wMS0xNiAwODozMzoyMiArMDgwMA==
date_gmt: !binary |-
  MjAwOC0wMS0xNiAwMDozMzoyMiArMDgwMA==
categories:
- 脚本语言
tags:
- php
comments: []
---
<div class="codeText">
<div class="codeHead">PHP代码<&#47;div></p>
<ol class="dp-c" start="1">
<li class="alt"><span><span><?php&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span><span class="comment">&#47;&#47;&nbsp;we&nbsp;will&nbsp;do&nbsp;our&nbsp;own&nbsp;error&nbsp;handling<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span><span class="func">error_reporting<&#47;span><span>(E_ALL);&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;<&#47;span><&#47;li>
<li class="alt"><span><span class="comment">&#47;&#47;&nbsp;user&nbsp;defined&nbsp;error&nbsp;handling&nbsp;function<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span><span class="keyword">function<&#47;span><span>&nbsp;userErrorHandler(<&#47;span><span class="vars">$errno<&#47;span><span>,&nbsp;<&#47;span><span class="vars">$errmsg<&#47;span><span>,&nbsp;<&#47;span><span class="vars">$filename<&#47;span><span>,&nbsp;<&#47;span><span class="vars">$linenum<&#47;span><span>,&nbsp;<&#47;span><span class="vars">$vars<&#47;span><span>)&nbsp;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>{&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;timestamp&nbsp;for&nbsp;the&nbsp;error&nbsp;entry<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$dt<&#47;span><span>&nbsp;=&nbsp;<&#47;span><span class="func">date<&#47;span><span>(<&#47;span><span class="string">"Y-m-d&nbsp;H:i:s&nbsp;(T)"<&#47;span><span>);&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;<&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;define&nbsp;an&nbsp;assoc&nbsp;array&nbsp;of&nbsp;error&nbsp;string<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;in&nbsp;reality&nbsp;the&nbsp;only&nbsp;entries&nbsp;we&nbsp;should<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;consider&nbsp;are&nbsp;E_WARNING,&nbsp;E_NOTICE,&nbsp;E_USER_ERROR,<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;E_USER_WARNING&nbsp;and&nbsp;E_USER_NOTICE<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$errortype<&#47;span><span>&nbsp;=&nbsp;<&#47;span><span class="keyword">array<&#47;span><span>&nbsp;(&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Error'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_WARNING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Warning'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_PARSE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Parsing&nbsp;Error'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_NOTICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Notice'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_CORE_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Core&nbsp;Error'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_CORE_WARNING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Core&nbsp;Warning'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_COMPILE_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Compile&nbsp;Error'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_COMPILE_WARNING&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Compile&nbsp;Warning'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_USER_ERROR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'User&nbsp;Error'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_USER_WARNING&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'User&nbsp;Warning'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_USER_NOTICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'User&nbsp;Notice'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_STRICT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;<span class="string">'Runtime&nbsp;Notice'<&#47;span><span>,&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E_RECOVERABLE_ERROR&nbsp;&nbsp;=>&nbsp;<span class="string">'Catchable&nbsp;Fatal&nbsp;Error'<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;set&nbsp;of&nbsp;errors&nbsp;for&nbsp;which&nbsp;a&nbsp;var&nbsp;trace&nbsp;will&nbsp;be&nbsp;saved<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$user_errors<&#47;span><span>&nbsp;=&nbsp;<&#47;span><span class="keyword">array<&#47;span><span>(E_USER_ERROR,&nbsp;E_USER_WARNING,&nbsp;E_USER_NOTICE);&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;=&nbsp;<&#47;span><span class="string">"<errorentry>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"\t<datetime>"<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="vars">$dt<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="string">"<&#47;datetime>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"\t<errornum>"<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="vars">$errno<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="string">"<&#47;errornum>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"\t<errortype>"<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="vars">$errortype<&#47;span><span>[<&#47;span><span class="vars">$errno<&#47;span><span>]&nbsp;.&nbsp;<&#47;span><span class="string">"<&#47;errortype>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"\t<errormsg>"<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="vars">$errmsg<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="string">"<&#47;errormsg>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"\t<scriptname>"<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="vars">$filename<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="string">"<&#47;scriptname>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"\t<scriptlinenum>"<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="vars">$linenum<&#47;span><span>&nbsp;.&nbsp;<&#47;span><span class="string">"<&#47;scriptlinenum>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;<&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if<&#47;span><span>&nbsp;(in_array(<&#47;span><span class="vars">$errno<&#47;span><span>,&nbsp;<&#47;span><span class="vars">$user_errors<&#47;span><span>))&nbsp;{&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"\t<vartrace>"<&#47;span><span>&nbsp;.&nbsp;wddx_serialize_value(<&#47;span><span class="vars">$vars<&#47;span><span>,&nbsp;<&#47;span><span class="string">"Variables"<&#47;span><span>)&nbsp;.&nbsp;<&#47;span><span class="string">"<&#47;vartrace>\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$err<&#47;span><span>&nbsp;.=&nbsp;<&#47;span><span class="string">"<&#47;errorentry>\n\n"<&#47;span><span>;&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;for&nbsp;testing<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;echo&nbsp;$err;<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;<&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">&#47;&#47;&nbsp;save&nbsp;to&nbsp;the&nbsp;error&nbsp;log,&nbsp;and&nbsp;e-mail&nbsp;me&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;critical&nbsp;user&nbsp;error<&#47;span><span>&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="func">error_log<&#47;span><span>(<&#47;span><span class="vars">$err<&#47;span><span>,&nbsp;3,&nbsp;<&#47;span><span class="string">"error.log"<&#47;span><span>);&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if<&#47;span><span>&nbsp;(<&#47;span><span class="vars">$errno<&#47;span><span>&nbsp;==&nbsp;E_USER_ERROR)&nbsp;{&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mail(<span class="string">"myseaprince@qq.com"<&#47;span><span>,&nbsp;<&#47;span><span class="string">"Critical&nbsp;User&nbsp;Error"<&#47;span><span>,&nbsp;<&#47;span><span class="vars">$err<&#47;span><span>);&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span>}&nbsp;&nbsp;<&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span><span class="vars">$old_error_handler<&#47;span><span>&nbsp;=&nbsp;set_error_handler(<&#47;span><span class="string">"userErrorHandler"<&#47;span><span>);&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span>mysql_connect(<span class="string">"localhost"<&#47;span><span>,&nbsp;<&#47;span><span class="string">"root"<&#47;span><span>,&nbsp;<&#47;span><span class="string">""<&#47;span><span>);&nbsp;&nbsp;<&#47;span><&#47;span><&#47;li>
<li class="alt"><span>&nbsp;&nbsp;<&#47;span><&#47;li>
<li class=""><span>?><&#47;span><&#47;li><br />
<&#47;ol><br />
<&#47;div></p>
<p>把PHP的错误显示控制住，并按自己的方式显示。<&#47;p></p>
