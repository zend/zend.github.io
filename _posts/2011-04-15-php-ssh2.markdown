---
layout: post
status: publish
published: true
title: PHP SSH2
author:
  display_name: admin
  login: admin
  email: combbs@gmail.com
  url: http://seaprince.cn/
author_login: admin
author_email: combbs@gmail.com
author_url: http://seaprince.cn/
wordpress_id: 586
wordpress_url: http://blog.eaxi.com/?p=586
date: !binary |-
  MjAxMS0wNC0xNSAwMDozNToyMiArMDgwMA==
date_gmt: !binary |-
  MjAxMS0wNC0xNCAxNjozNToyMiArMDgwMA==
categories:
- 不想分类
tags:
- php ssh2 linux
comments: []
---
<p>function exec($cfg)<br />
    {<br />
        $conn = ssh2_connect($cfg['fip'], C('SSH_PORT'));<br />
        if (!$conn) return "cannot connect to server {$cfg}:".C('SSH_PORT');</p>
<p>        $auth = ssh2_auth_password($conn, $cfg['flogin'], $cfg['floginpwd']);<br />
        if (!$auth) return "auth failed";</p>
<p>        $stdout_stream = ssh2_exec($conn, C('REALTIME_CMD'));<br />
        &#47;&#47;$stdio_stream = ssh2_shell($conn);</p>
<p>        $stderr_stream = ssh2_fetch_stream($stdout_stream, SSH2_STREAM_STDERR);</p>
<p>        stream_set_blocking($stderr_stream, true);<br />
        stream_set_blocking($stdout_stream, true);</p>
<p>        $out = "";<br />
        while($line = fgets($stdout_stream)) { flush(); $out .= $line;}</p>
<p>        $err = "";<br />
        while($line = fgets($err_stream)) { flush(); $err .= $line; }</p>
<p>        fclose($stdout_stream);<br />
        fclose($stderr_stream);</p>
<p>        return array($out, $err);<br />
    }<br />
<a href='http:&#47;&#47;blog.eaxi.com&#47;wp-content&#47;uploads&#47;2011&#47;04&#47;php_ssh2.dll_.zip'>php_ssh2.dll<&#47;a></p>
