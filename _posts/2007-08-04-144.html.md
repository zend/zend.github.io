---
title: 自定义、个性化smarty里的html_checkboxes
author: admin
excerpt: |
  <p>最近这个项目里，涉及到很多表单的处理，select, radio, checkbox等等。而且这些都是动态生成的，所以就必须得找一个好办法处理这些表单元素。<br />
  <br />
  由于系统采用smarty，所以首先考虑用smarty自带的表单处理函数，html_checkboxes，html_options，html_radios，html_select_date，html_select_time，html_select_time等。。<br />
  <br />
  但是在使用的过程中，html_checkboxes却很讨厌。</p>
layout: post
permalink: /20070804-144.html
categories:
  - 个人作品
tags:
  - php
  - smarty
---
最近这个项目里，涉及到很多表单的处理，select, radio, checkbox等等。而且这些都是动态生成的，所以就必须得找一个好办法处理这些表单元素。

由于系统采用smarty，所以首先考虑用smarty自带的表单处理函数，html\_checkboxes，html\_options， html\_radios，html\_select\_date，html\_select\_time，html\_select_time等。。

但是在使用的过程中，html_checkboxes却很讨厌。只有一个separator方法，要么弄成一行，要么弄成一列，元素一多了都很丑。比不上用表格控制。

解决方案一：给smarty的源文件动了一下小手术。

先加一个参数：

<div class="codeText">
  <div class="codeHead">
    PHP代码
  </div>
  
  <ol class="dp-c" start="1">
    <li class="alt">
      <span><span class="keyword">case</span><span>&nbsp;</span><span class="string">&#8216;cols&#8217;</span><span>:&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;$<span class="vars">$_key</span><span>&nbsp;=&nbsp;</span><span class="func">intval</span><span>(</span><span class="vars">$_val</span><span>);&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">break</span><span>;&nbsp;&nbsp;</span></span>
    </li>
  </ol>
</div>

修改返回值：

<div class="codeText">
  <div class="codeHead">
    PHP代码
  </div>
  
  <ol class="dp-c" start="1">
    <li class="alt">
      <span><span class="keyword">if</span><span>(!</span><span class="keyword">empty</span><span class="func">empty</span><span>(</span><span class="vars">$params</span><span>[</span><span class="string">'assign'</span><span>]))&nbsp;{&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$smarty</span><span>->assign(</span><span class="vars">$params</span><span>[</span><span class="string">'assign'</span><span>],&nbsp;</span><span class="vars">$_html_result</span><span>);&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>}&nbsp;<span class="keyword">else</span><span>&nbsp;{&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(&nbsp;isset(</span><span class="vars">$cols</span><span>)&nbsp;)&nbsp;{&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$ret</span><span>&nbsp;=&nbsp;</span><span class="string">&#8216;<table&nbsp;width=100%><tr>&#8217;</span><span>;&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$_i</span><span>&nbsp;=&nbsp;0;&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">foreach</span><span>&nbsp;(</span><span class="vars">$_html_result</span><span>&nbsp;</span><span class="keyword">as</span><span>&nbsp;</span><span class="vars">$_val</span><span>)&nbsp;{&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$_i</span><span>++;&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$ret</span><span>&nbsp;.=&nbsp;</span><span class="string">"<td>$_val</td>"</span><span>;&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span><span>&nbsp;(</span><span class="vars">$_i</span><span>%</span><span class="vars">$cols</span><span>===0)&nbsp;{&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$ret</span><span>&nbsp;.=&nbsp;</span><span class="string">"</tr><tr>"</span><span>;&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="vars">$ret</span><span>&nbsp;.=&nbsp;</span><span class="string">"</tr></table>"</span><span>;&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;</span><span class="vars">$ret</span><span>;&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">else</span><span>&nbsp;{&nbsp;&nbsp;</span></span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;implode(</span><span class="string">"\n"</span><span>,</span><span class="vars">$_html_result</span><span>);&nbsp;&nbsp;</span></span>
    </li>
    <li class="">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span>
    </li>
    <li class="alt">
      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
    </li>
    <li class="">
      <span>}&nbsp;&nbsp;</span>
    </li>
  </ol>
</div>

大功告成，smarty模板文件里的调用：

<div class="codeText">
  <div class="codeHead">
    XML/HTML代码
  </div>
  
  <ol class="dp-xml" start="1">
    <li class="alt">
      <span><span>{{html_checkboxes&nbsp;</span><span class="attribute">name</span><span>=</span><span class="attribute-value">"stateserve"</span><span>&nbsp;</span><span class="attribute">options</span><span>=$stateserve&nbsp;</span><span class="attribute">cols</span><span>=</span><span class="attribute-value">8</span><span>}}&nbsp;&nbsp;</span></span>
    </li>
  </ol>
</div>

解决方案二：  
不直接显示，先取得返回值，再用html_table显示它：  
使用html_checkboxes里的隐藏参数assign:

<div class="codeText">
  <div class="codeHead">
    XML/HTML代码
  </div>
  
  <ol class="dp-xml" start="1">
    <li class="alt">
      <span><span>{{html_checkboxes&nbsp;</span><span class="attribute">name</span><span>=</span><span class="attribute-value">"stateserve"</span><span>&nbsp;</span><span class="attribute">options</span><span>=$stateserve&nbsp;</span><span class="attribute">cols</span><span>=</span><span class="attribute-value">8</span><span>&nbsp;</span><span class="attribute">assign</span><span>=</span><span class="attribute-value">"checkboxes"</span><span>}}&nbsp;&nbsp;</span></span>
    </li>
  </ol>
</div>

这里，相应于执行了一次

<div class="codeText">
  <div class="codeHead">
    PHP代码
  </div>
  
  <ol class="dp-c" start="1">
    <li class="alt">
      <span><span class="vars">$smarty</span><span>->assign(</span><span class="string">"checkboxes"</span><span>,</span><span class="vars">$_html_result</span><span>);&nbsp;&nbsp;</span></span>
    </li>
  </ol>
</div>

得到了$checkboxes这个smarty变量。下面用html_table显示它：

<div class="codeText">
  <div class="codeHead">
    XML/HTML代码
  </div>
  
  <ol class="dp-xml" start="1">
    <li class="alt">
      <span><span>{{html_table&nbsp;</span><span class="attribute">loop</span><span>=$checkboxes&nbsp;</span><span class="attribute">cols</span><span>=</span><span class="attribute-value">8</span><span> </span><span class="attribute">table_attr</span><span>=</span><span class="attribute-value">&#8216;border="0"&#8217;</span><span>}}&nbsp;&nbsp;</span></span>
    </li>
  </ol>
</div>

两种方案的效果一样。